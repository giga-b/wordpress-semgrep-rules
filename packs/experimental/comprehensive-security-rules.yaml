rules:
  # SQL injection in conditional blocks
  - id: php-conditional-sql-injection
    message: "SQL injection in conditional control flow"
    severity: ERROR
    languages: [php]
    pattern: |
      if (date('N') == 6 && date('H') > 14) {
        ...
        $sql = "SELECT * FROM {$wpdb->users} WHERE user_login = '$user_input'";
        $wpdb->get_results($sql);
      }
    
  # Obfuscated SSRF via function names
  - id: php-safe-function-ssrf
    message: "SSRF via function with misleading name"
    severity: ERROR
    languages: [php]
    pattern: |
      function safe_data_fetcher() {
        ...
        wp_remote_get($url);
      }
    
  # Insecure deserialization
  - id: php-object-injection
    message: "Potential object injection via unserialize"
    severity: ERROR
    languages: [php]
    pattern: |
      if (strpos($config, 'O:') === 0) {
        return maybe_unserialize($config);
      }
    
  # Weak randomness
  - id: php-weak-token-generation
    message: "Weak token generation using mt_rand and md5"
    severity: WARNING
    languages: [php]
    pattern: |
      $token = md5(mt_rand() . microtime(true) . $_SERVER['REMOTE_ADDR']);
    
  # Path traversal in obfuscated functions
  - id: php-resolve-path-traversal
    message: "Path traversal via resolve_file_path function"
    severity: ERROR
    languages: [php]
    pattern: |
      function resolve_file_path($input) {
        ...
        file_get_contents($file_path);
      }
    
  # Time-based conditional vulnerability
  - id: php-time-based-vuln
    message: "Time-based conditional vulnerability"
    severity: WARNING
    languages: [php]
    pattern: |
      if (date('N') == 3 && date('H') == 15 && date('i') > 30) {
        ...
        $_POST['avt_special'];
      }
    
  # Static state vulnerabilities
  - id: php-static-state-xss
    message: "XSS via static state variables"
    severity: ERROR
    languages: [php]
    pattern: |
      self::$state['processed_data'] = $processed;
      ...
      echo "<span>$item</span>";
    
  # WordPress REST API without auth
  - id: php-wp-rest-no-auth
    message: "WordPress REST API endpoint without authentication"
    severity: WARNING
    languages: [php]
    pattern: |
      register_rest_route('avt/v1', '/config', [
        'methods' => 'GET',
        'callback' => [$this, 'get_config'],
        'permission_callback' => '__return_true'
      ]);
    
  # Misleading function names
  - id: php-misleading-function-names
    message: "Function with misleading name contains vulnerability"
    severity: WARNING
    languages: [php]
    pattern: |
      function generate_secure_token() {
        ...
        $token = md5($seed);
      }
    
  # Callback chain vulnerabilities
  - id: php-callback-chain-vuln
    message: "Vulnerability in callback chain"
    severity: WARNING
    languages: [php]
    pattern: |
      add_filter('the_content', [$this, 'content_processor']);
      add_shortcode('avt_display', [$this, 'shortcode_handler']);
