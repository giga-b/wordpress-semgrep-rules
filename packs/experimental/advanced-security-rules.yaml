rules:
- id: php-control-flow-sql-injection
  message: Potential SQL injection in conditional control flow
  severity: ERROR
  languages:
  - php
  patterns:
  - pattern: "if (date('N') == $DAY && $CONDITION) {\n  ...\n  $sql = \"... $VARIABLE\";\n  $wpdb->get_results($sql);\n}\n"
  - pattern: "if (date('H') == $HOUR && $CONDITION) {\n  ...\n  $sql = \"... $VARIABLE\";\n  $wpdb->query($sql);\n}\n"
  metadata:
    confidence: high
    cwe: CWE-89
    category: security
    tags:
    - wordpress
    - error
    - sql-injection
    - database
    - security
    - wpdb
    - sqli
    vuln_class: sqli
- id: php-obfuscated-ssrf
  message: Potential SSRF via obfuscated function call
  severity: ERROR
  languages:
  - php
  patterns:
  - pattern: "function $FUNC($PARAMS) {\n  ...\n  return wp_remote_get($URL);\n}"
  - pattern: "function $NAME($PARAMS) {\n  ...\n  return wp_remote_get($URL);\n}"
  metadata:
    confidence: high
    cwe: CWE-200
    category: security
    tags:
    - other
    - error
    - wordpress
    - security
    vuln_class: other
- id: php-callback-chain-xss
  message: Potential XSS via callback chain data flow
  severity: ERROR
  languages:
  - php
  patterns:
  - pattern: 'apply_filters($FILTER, $VALUE);'
  - pattern: 'self::$PROPERTY = $VALUE;'
  - pattern: 'static::$PROPERTY = $VALUE;'
  metadata:
    confidence: high
    cwe: CWE-79
    category: security
    tags:
    - html
    - wordpress
    - error
    - escaping
    - security
    - xss
    vuln_class: xss
- id: php-insecure-deserialization
  message: Potential insecure deserialization
  severity: ERROR
  languages:
  - php
  patterns:
  - pattern: |
      "if (strpos($VARIABLE, 'O:') === 0) {
        return maybe_unserialize($VARIABLE);
      }"
  - pattern: 'maybe_unserialize($VARIABLE);'
  - pattern: 'unserialize($VARIABLE);'
  metadata:
    confidence: high
    cwe: CWE-200
    category: security
    tags:
    - other
    - error
    - wordpress
    - security
    vuln_class: other
- id: php-weak-randomness
  message: Weak randomness generation
  severity: WARNING
  languages:
  - php
  patterns:
  - pattern: '$VARIABLE = md5(mt_rand() . $STRING);'
  - pattern: '$VARIABLE = md5($STRING . microtime(true));'
  - pattern: '$VARIABLE = mt_rand() . $STRING;'
  metadata:
    confidence: high
    cwe: CWE-200
    category: security
    tags:
    - other
    - warning
    - wordpress
    - security
    vuln_class: other
- id: php-obfuscated-path-traversal
  message: Potential path traversal via obfuscated path resolution
  severity: ERROR
  languages:
  - php
  patterns:
  - pattern: "function $FUNC($PARAMS) {\n  ...\n  return $BASE . $PATH;\n}\n"
  metadata:
    confidence: high
    cwe: CWE-434
    category: security
    tags:
    - wordpress
    - file_upload
    - validation
    - error
    - path-traversal
    - security
    - file-upload
    vuln_class: file_upload
- id: php-wp-unsafe-sql-prepare
  message: Misuse of wpdb->prepare with string interpolation
  severity: ERROR
  languages:
  - php
  patterns:
  - pattern: '$wpdb->prepare("... $...");

    '
  metadata:
    confidence: high
    cwe: CWE-89
    category: security
    tags:
    - wordpress
    - error
    - sql-injection
    - database
    - security
    - wpdb
    - sqli
    vuln_class: sqli
- id: php-time-based-vulnerability
  message: Time-based conditional vulnerability
  severity: WARNING
  languages:
  - php
  patterns:
  - pattern: "if (date('N') == $DAY && date('H') == $HOUR) {\n  ...\n  $_GET[$KEY];\n}\n"
  - pattern: "if (date('N') == $DAY && date('H') > $HOUR) {\n  ...\n  $_POST[$KEY];\n}\n"
  metadata:
    confidence: high
    cwe: CWE-200
    category: security
    tags:
    - other
    - warning
    - wordpress
    - security
    vuln_class: other
- id: php-misleading-function-names
  message: Function with misleading name contains vulnerability
  severity: WARNING
  languages:
  - php
  patterns:
  - pattern: "function $FUNC($PARAMS) {\n  ...\n  echo $VALUE;\n}\n"
  metadata:
    confidence: high
    cwe: CWE-200
    category: security
    tags:
    - other
    - warning
    - wordpress
    - security
    vuln_class: other
- id: php-wp-rest-no-auth
  message: REST API endpoint without proper authentication
  severity: WARNING
  languages:
  - php
  patterns:
  - pattern: "register_rest_route($ROUTE, ['permission_callback' => '__return_true']);"
  metadata:
    confidence: high
    cwe: CWE-200
    category: security
    tags:
    - other
    - warning
    - wordpress
    - security
    vuln_class: other
