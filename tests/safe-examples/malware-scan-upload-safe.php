<?php
// Safe: upload with malware scanning step

if (!function_exists('sanitize_file_name')) { function sanitize_file_name($s){ return $s; } }
if (!function_exists('wp_max_upload_size')) { function wp_max_upload_size(){ return 10 * 1024 * 1024; } }

function scan_uploaded_file($path) {
    // stub scanning routine; return true if clean
    return true;
}

function upload_with_scan() {
    if (!isset($_FILES['file'])) { return; }
    $file = $_FILES['file'];
    // Enforce size limit
    if ($file['size'] > wp_max_upload_size()) { return; }
    $safe = sanitize_file_name($file['name']);
    $dest = '/var/www/html/wp-content/uploads/' . $safe;
    // Scan before moving
    if (!scan_uploaded_file($file['tmp_name'])) { return; }
    move_uploaded_file($file['tmp_name'], $dest);
}


