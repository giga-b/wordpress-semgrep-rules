(function($){$('body').on('submit','.gamipress-coupons-form',function(e){e.preventDefault();return!1});$('body').on('keypress','.gamipress-coupons-form',function(e){return e.keyCode!=13});$('body').on('click','.gamipress-coupons-form .gamipress-coupons-form-submit-button',function(e){e.preventDefault();var $this=$(this);var form=$(this).closest('.gamipress-coupons-form');var submit_wrap=form.find('.gamipress-coupons-form-submit');var code=form.find('input[name="code"]').val();if(submit_wrap.find('.gamipress-coupons-form-response').length===0){submit_wrap.prepend('<div class="gamipress-coupons-form-response" style="display: none;"></div>')}
var response_wrap=submit_wrap.find('.gamipress-coupons-form-response');if(!code.length){response_wrap.addClass('gamipress-coupons-error');response_wrap.html(gamipress_coupons.empty_code_error);response_wrap.slideDown();return}
$this.prop('disabled',!0);if(response_wrap.length){response_wrap.slideUp()}
submit_wrap.find('.gamipress-spinner').show();form.trigger('gamipress_coupons_before_redeem_coupon_request');$.ajax({url:gamipress_coupons.ajaxurl,method:'POST',data:form.serialize()+'&action=gamipress_coupons_redeem_coupon',success:function(response){response_wrap.addClass('gamipress-coupons-'+(response.success===!0?'success':'error'));response_wrap.html((response.data.message!==undefined?response.data.message:response.data));response_wrap.slideDown();$this.prop('disabled',!1);submit_wrap.find('.gamipress-spinner').hide();form.trigger('gamipress_coupons_redeem_coupon_'+(response.success===!0?'success':'error'));form.trigger('gamipress_coupons_after_redeem_coupon_request');if(response.data.redirect===!0&&response.data.redirect_url!==undefined&&response.data.redirect_url.length){window.location.href=response.data.redirect_url}},error:function(response){form.trigger('gamipress_coupons_redeem_coupon_error');form.trigger('gamipress_coupons_after_redeem_coupon_request')}})})})(jQuery)