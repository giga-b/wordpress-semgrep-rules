(function($){$('#_gamipress_coupons_allowed_roles, #_gamipress_coupons_excluded_roles').gamipress_select2({theme:'default gamipress-select2',placeholder:'Select role(s)',allowClear:!0,multiple:!0});$('#_gamipress_coupons_allowed_users, #_gamipress_coupons_excluded_users').gamipress_select2({ajax:{url:ajaxurl,dataType:'json',delay:250,type:'POST',data:function(params){return{q:params.term,action:'gamipress_get_users',nonce:gamipress_coupons_coupons.nonce}},processResults:gamipress_select2_users_process_results},escapeMarkup:function(markup){return markup},templateResult:gamipress_select2_users_template_result,theme:'default gamipress-select2',placeholder:'Select an User',allowClear:!0,multiple:!0});$('body').on('change','#_gamipress_coupons_restrict_to_users',function(){var target=$('.cmb2-id--gamipress-coupons-allowed-users, .cmb2-id--gamipress-coupons-allowed-roles');var target_2=$('.cmb2-id--gamipress-coupons-excluded-users, .cmb2-id--gamipress-coupons-excluded-roles');if($(this).prop('checked')){target.slideDown();target_2.slideUp()}else{target.slideUp();target_2.slideDown()}});if(!$('#_gamipress_coupons_restrict_to_users').prop('checked')){$('.cmb2-id--gamipress-coupons-allowed-users, .cmb2-id--gamipress-coupons-allowed-roles').hide()}else{$('.cmb2-id--gamipress-coupons-excluded-users, .cmb2-id--gamipress-coupons-excluded-roles').hide()}
$('body').on('change','.gamipress-coupons-coupon-reward-post-type select',function(){var post_type=$(this).val();var container=$(this).closest('.cmb-repeatable-grouping');var post_id_container=container.find('.gamipress-coupons-coupon-reward-post-id');var quantity_container=container.find('.gamipress-coupons-coupon-reward-quantity');var post_id_field=post_id_container.find('select');if(post_type in gamipress_coupons_coupons.points_types){var post_id=gamipress_coupons_coupons.points_types[post_type].ID;var plural_name=gamipress_coupons_coupons.points_types[post_type].plural_name;post_id_field.html('<option value="'+post_id+'">'+plural_name+'</option>');post_id_field.val(post_id);post_id_container.hide();quantity_container.slideDown()}else{var action='';if(post_type in gamipress_coupons_coupons.achievement_types){action='gamipress_get_achievements_options_html';post_id_container.find('.cmb-th label').text(gamipress_coupons_coupons.strings.achievement)}else if(post_type in gamipress_coupons_coupons.rank_types){action='gamipress_get_ranks_options_html';post_id_container.find('.cmb-th label').text(gamipress_coupons_coupons.strings.rank)}
if(!post_id_container.find('.spinner').length){post_id_container.find('.cmb-td').prepend('<span class="spinner" style="float: none;"></span>')}
var spinner=post_id_container.find('.spinner');post_id_field.slideUp();post_id_container.slideDown();quantity_container.slideUp();spinner.addClass('is-active');$.ajax({url:ajaxurl,data:{action:action,nonce:gamipress_coupons_coupons.nonce,post_type:post_type,achievement_type:post_type,selected:post_id_field.val()},success:function(response){spinner.removeClass('is-active');post_id_field.html(response);post_id_field.slideDown()}})}});$('.gamipress-coupons-coupon-reward-post-type select').trigger('change');$('#add-new-coupon-note').on('click',function(e){e.preventDefault();$(this).parent().slideUp();$('#new-coupon-note-fieldset').slideDown()});$('#save-coupon-note').on('click',function(e){e.preventDefault();var $this=$(this);if($this.hasClass('disabled')){return}
$this.addClass('disabled');var title=$('#coupon-note-title').val();var description=$('#coupon-note-description').val();var notice=$('#new-coupon-note-submit .notice');if(title.length===0||description.length===0){notice.find('.error').html('Please, fill the form correctly');notice.removeClass('hidden');return}
if(!notice.hasClass('hidden')){notice.addClass('hidden')}
$.ajax({url:ajaxurl,data:{action:'gamipress_coupons_add_coupon_note',nonce:gamipress_coupons_coupons.nonce,coupon_id:$('#ct_edit_form input#object_id').val(),title:title,description:description},success:function(response){if(response.success){$('.coupon-notes-list tbody').prepend(response.data);$this.closest('#new-coupon-note-fieldset').slideUp();$this.closest('#new-coupon-note-fieldset').prev().slideDown();$('#coupon-note-title').val('');$('#coupon-note-description').val('')}else{notice.find('.error').html(response.data);notice.removeClass('hidden')}
$this.removeClass('disabled')}})});$('#cancel-coupon-note').on('click',function(e){e.preventDefault();$(this).closest('#new-coupon-note-fieldset').slideUp();$(this).closest('#new-coupon-note-fieldset').prev().slideDown();$('#coupon-note-title').val('');$('#coupon-note-description').val('')});$('.coupon-note .row-actions .delete').on('click',function(e){e.preventDefault();var confirmed=confirm('Do you want to remove this coupon note?');var $this=$(this);if(confirmed){$this.closest('.coupon-note').fadeOut();$.ajax({url:ajaxurl,data:{action:'gamipress_coupons_delete_coupon_note',nonce:gamipress_coupons_coupons.nonce,coupon_note_id:$this.data('coupon-note-id'),},success:function(response){if(response.success){$this.closest('.coupon-note').remove()}else{$this.closest('.coupon-note').fadeIn()}}})}})})(jQuery)