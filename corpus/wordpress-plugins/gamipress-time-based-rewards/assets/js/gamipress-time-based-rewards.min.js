(function($){setInterval(function(){$('.gamipress-time-based-reward:not(.can-claim), .gamipress-single-time-based-reward:not(.can-claim)').each(function(){gamipress_time_based_rewards_update_next_claim_counter($(this))})},1000);$('body').on('click','.gamipress-time-based-reward-claim-button',function(e){var button=$(this);var time_based_reward=button.closest('.gamipress-time-based-reward');if(time_based_reward.length===0)
time_based_reward=button.closest('.gamipress-single-time-based-reward');var submit_wrap=button.closest('.gamipress-time-based-reward-claim');var spinner=submit_wrap.find('.gamipress-spinner');var time_based_reward_id=button.data('id');button.prop('disabled',!0);$('.gamipress-time-based-reward.can-claim .gamipress-time-based-reward-claim-button').prop('disabled',!0);$('.gamipress-single-time-based-reward.can-claim .gamipress-time-based-reward-claim-button').prop('disabled',!0);if(submit_wrap.find('.gamipress-time-based-reward-claim-response').length)
submit_wrap.find('.gamipress-time-based-reward-claim-response').slideUp();spinner.show();$.ajax({url:gamipress_time_based_rewards.ajaxurl,method:'POST',dataType:'json',data:{action:'gamipress_time_based_rewards_claim',nonce:gamipress_time_based_rewards.nonce,time_based_reward_id:time_based_reward_id},success:function(response){if(response.success===!0){$('.gamipress-time-based-rewards-popup-wrapper').remove();$('body').append(response.data.rewards_popup);$('.gamipress-time-based-rewards-popup-wrapper').fadeIn(400,function(){time_based_reward.find('.gamipress-time-based-reward-next-reward-counter').text(response.data.next_claim);time_based_reward.removeClass('can-claim');spinner.hide();$('.gamipress-time-based-reward.can-claim .gamipress-time-based-reward-claim-button').prop('disabled',!1);$('.gamipress-single-time-based-reward.can-claim .gamipress-time-based-reward-claim-button').prop('disabled',!1)})}else{if(submit_wrap.find('.gamipress-time-based-reward-claim-response').length===0)
submit_wrap.prepend('<div class="gamipress-time-based-reward-claim-response gamipress-notice" style="display: none;"></div>');var response_wrap=submit_wrap.find('.gamipress-time-based-reward-claim-response');response_wrap.addClass('gamipress-notice-'+(response.success===!0?'success':'error'));response_wrap.html(response.data);response_wrap.slideDown();spinner.hide();button.prop('disabled',!1);$('.gamipress-time-based-reward.can-claim .gamipress-time-based-reward-claim-button').prop('disabled',!1);$('.gamipress-single-time-based-reward.can-claim .gamipress-time-based-reward-claim-button').prop('disabled',!1)}}})});$('body').on('click','.gamipress-time-based-reward-popup-button, .gamipress-time-based-rewards-popup-overlay',function(e){$(this).closest('.gamipress-time-based-rewards-popup-wrapper').fadeOut()})})(jQuery);function gamipress_time_based_rewards_update_next_claim_counter(time_based_reward){var counter_element=time_based_reward.find('.gamipress-time-based-reward-next-reward-counter');var counter=counter_element.text().trim();if(counter==='0H 0M 0S')return;var counter_parts=counter.split(' ');var has_days=!1;var d=0;var h=0;var m=0;var s=0;if(counter_parts.length===4){has_days=!0;d=parseInt(counter_parts[0].replace('D',''));h=parseInt(counter_parts[1].replace('H',''));m=parseInt(counter_parts[2].replace('M',''));s=parseInt(counter_parts[3].replace('S',''))}else{h=parseInt(counter_parts[0].replace('H',''));m=parseInt(counter_parts[1].replace('M',''));s=parseInt(counter_parts[2].replace('S',''))}
if(s<0)s=0;if(s===0){if(m<0)m=0;if(m===0){if(h<0)h=0;if(has_days&&h===0){h=24;if(d>0)d--}
m=60;if(h>0)h--}
s=60;if(m>0)m--}
if(s>0)
s--;var new_counter=(has_days?d+'D ':'')+h+'H '+m+'M '+s+'S';counter_element.text(new_counter);if((d+h+m+s)===0){time_based_reward.addClass('can-claim');time_based_reward.find('.gamipress-time-based-reward-claim-button').prop('disabled',!1)}}
function gamipress_time_based_rewards_get_human_next_claim_date(time_based_reward){var next_claim_date=time_based_reward.find('.gamipress-time-based-reward-next-reward-counter').data('next-date');if(!next_claim_date.length)return;var date=new Date();var next_date=new Date(next_claim_date).getTime();if(date>=next_date)
return '0H 0M 0S';var d,h,m,s,ms;ms=next_date-date;s=Math.floor(ms/1000);m=Math.floor(s/60);s=s%60;h=Math.floor(m/60);m=m%60;d=Math.floor(h/24);h=h%24;return h+'H '+m+'M '+s+'S'}