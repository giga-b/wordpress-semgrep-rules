<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PressGuard - Security Scan Results</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }
        .scan-summary {
            padding: 30px;
            border-bottom: 1px solid #e1e5e9;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .summary-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        .summary-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        .summary-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        .findings-section {
            padding: 30px;
        }
        .findings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .filter-controls {
            display: flex;
            gap: 10px;
        }
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
        }
        .finding-card {
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            margin-bottom: 15px;
            overflow: hidden;
        }
        .finding-header {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e1e5e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .finding-title {
            font-weight: 600;
            color: #333;
        }
        .severity-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: 600;
        }
        .severity-error { background: #dc3545; color: white; }
        .severity-warning { background: #ffc107; color: #212529; }
        .severity-info { background: #17a2b8; color: white; }
        .finding-content {
            padding: 20px;
        }
        .finding-details {
            margin-bottom: 15px;
        }
        .detail-row {
            display: flex;
            margin-bottom: 8px;
        }
        .detail-label {
            font-weight: 600;
            width: 120px;
            color: #666;
        }
        .detail-value {
            flex: 1;
            color: #333;
        }
        .code-snippet {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 10px 0;
        }
        .fix-suggestion {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
        }
        .fix-title {
            font-weight: 600;
            color: #155724;
            margin-bottom: 10px;
        }
        .fix-code {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin-top: 10px;
        }
        .rule-info {
            background: #e7f3ff;
            border: 1px solid #b3d9ff;
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
        }
        .rule-title {
            font-weight: 600;
            color: #004085;
            margin-bottom: 10px;
        }
        .no-findings {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        .no-findings h3 {
            color: #28a745;
            margin-bottom: 10px;
        }
        .export-section {
            padding: 20px 30px;
            background: #f8f9fa;
            border-top: 1px solid #e1e5e9;
            text-align: center;
        }
        .export-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
            margin: 0 10px;
        }
        .export-btn:hover {
            background: #5a6fd8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PressGuard User Dashboard</h1>
            <h2 style="margin: 10px 0; font-size: 1.6em; font-weight: normal; opacity: 0.9;">WordPress Semgrep Rules</h2>
            <h3 style="margin: 10px 0 0 0; font-size: 1.2em; font-weight: normal; opacity: 0.9;">Codebse Security Scan Results </h3>
        </div>
        
        <div class="scan-summary">
            <h2>Scan Summary</h2>
            <div class="summary-grid">
                <div class="summary-card">
                    <div class="summary-value" id="total-findings">0</div>
                    <div class="summary-label">Total Findings</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" id="files-scanned">0</div>
                    <div class="summary-label">Files Scanned</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" id="critical-issues">0</div>
                    <div class="summary-label">Critical Issues</div>
                </div>
                <div class="summary-card">
                    <div class="summary-value" id="scan-time">0s</div>
                    <div class="summary-label">Scan Duration</div>
                </div>
            </div>
        </div>
        
        <div class="findings-section">
            <div class="findings-header">
                <h2>Security Findings</h2>
                <div class="filter-controls">
                    <select class="filter-select" id="severity-filter">
                        <option value="">All Severities</option>
                        <option value="ERROR">Critical</option>
                        <option value="WARNING">Warning</option>
                        <option value="INFO">Info</option>
                    </select>
                    <select class="filter-select" id="rule-filter">
                        <option value="">All Rules</option>
                        <option value="nonce">Nonce Verification</option>
                        <option value="capability">Capability Checks</option>
                        <option value="sanitization">Sanitization</option>
                        <option value="xss">XSS Prevention</option>
                        <option value="sql">SQL Injection</option>
                    </select>
                </div>
            </div>
            
            <div id="findings-container">
                <!-- Findings will be populated by JavaScript -->
                <div class="no-findings">
                    <h3>ðŸŽ‰ No Security Issues Found!</h3>
                    <p>Your code appears to follow WordPress security best practices.</p>
                    <p>Consider running additional scans with different rule configurations for comprehensive coverage.</p>
                </div>
            </div>
        </div>
        
        <div class="export-section">
            <button class="export-btn" onclick="exportResults('json')">Export as JSON</button>
            <button class="export-btn" onclick="exportResults('csv')">Export as CSV</button>
            <button class="export-btn" onclick="exportResults('html')">Export as HTML</button>
        </div>
    </div>

    <script>
        // Sample scan results - in a real implementation, this would come from the actual scan
        const scanResults = {
            timestamp: new Date().toISOString(),
            totalFindings: 5,
            filesScanned: 25,
            criticalIssues: 2,
            scanTime: 3.2,
            findings: [
                {
                    id: 1,
                    rule: "wordpress.nonce.missing-verification",
                    ruleName: "Missing Nonce Verification",
                    severity: "ERROR",
                    message: "Nonce verification is missing. Use wp_verify_nonce() to verify the nonce before processing form data.",
                    file: "includes/admin-handlers.php",
                    line: 45,
                    column: 12,
                    code: "if (isset($_POST['submit'])) {\n    $data = $_POST['data'];\n    process_form_data($data);\n}",
                    fix: "Add nonce verification before processing form data",
                    fixCode: "if (isset($_POST['submit'])) {\n    if (wp_verify_nonce($_POST['_wpnonce'], 'my_form_action')) {\n        $data = $_POST['data'];\n        process_form_data($data);\n    }\n}",
                    ruleInfo: "This rule detects when form submissions are processed without proper nonce verification, which can lead to CSRF attacks."
                },
                {
                    id: 2,
                    rule: "wordpress.capability.missing-admin-check",
                    ruleName: "Missing Admin Capability Check",
                    severity: "ERROR",
                    message: "Missing admin capability check. Use current_user_can('manage_options') for admin-only operations.",
                    file: "includes/settings.php",
                    line: 23,
                    column: 8,
                    code: "if (isset($_POST['update_settings'])) {\n    update_option('sensitive_setting', $_POST['value']);\n}",
                    fix: "Add capability check before updating sensitive settings",
                    fixCode: "if (isset($_POST['update_settings'])) {\n    if (current_user_can('manage_options')) {\n        update_option('sensitive_setting', sanitize_text_field($_POST['value']));\n    }\n}",
                    ruleInfo: "This rule ensures that only users with appropriate permissions can perform administrative operations."
                },
                {
                    id: 3,
                    rule: "wordpress.sanitization.missing-input",
                    ruleName: "Unsanitized User Input",
                    severity: "WARNING",
                    message: "User input not sanitized. Use appropriate WordPress sanitization functions before using user data.",
                    file: "includes/display.php",
                    line: 67,
                    column: 15,
                    code: "$user_data = $_GET['search_term'];\necho $user_data;",
                    fix: "Sanitize user input before output",
                    fixCode: "$user_data = sanitize_text_field($_GET['search_term']);\necho esc_html($user_data);",
                    ruleInfo: "This rule detects when user input is used without proper sanitization, which can lead to XSS vulnerabilities."
                }
            ]
        };

        function updateSummary() {
            document.getElementById('total-findings').textContent = scanResults.totalFindings;
            document.getElementById('files-scanned').textContent = scanResults.filesScanned;
            document.getElementById('critical-issues').textContent = scanResults.criticalIssues;
            document.getElementById('scan-time').textContent = scanResults.scanTime + 's';
        }

        function renderFindings(findings = scanResults.findings) {
            const container = document.getElementById('findings-container');
            
            if (findings.length === 0) {
                container.innerHTML = `
                    <div class="no-findings">
                        <h3>ðŸŽ‰ No Security Issues Found!</h3>
                        <p>Your code appears to follow WordPress security best practices.</p>
                        <p>Consider running additional scans with different rule configurations for comprehensive coverage.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = findings.map(finding => `
                <div class="finding-card">
                    <div class="finding-header">
                        <div class="finding-title">${finding.ruleName}</div>
                        <span class="severity-badge severity-${finding.severity.toLowerCase()}">${finding.severity}</span>
                    </div>
                    <div class="finding-content">
                        <div class="finding-details">
                            <div class="detail-row">
                                <div class="detail-label">File:</div>
                                <div class="detail-value">${finding.file}:${finding.line}:${finding.column}</div>
                            </div>
                            <div class="detail-row">
                                <div class="detail-label">Message:</div>
                                <div class="detail-value">${finding.message}</div>
                            </div>
                        </div>
                        
                        <div class="code-snippet">${finding.code}</div>
                        
                        <div class="fix-suggestion">
                            <div class="fix-title">ðŸ’¡ How to Fix:</div>
                            <p>${finding.fix}</p>
                            <div class="fix-code">${finding.fixCode}</div>
                        </div>
                        
                        <div class="rule-info">
                            <div class="rule-title">ðŸ“– Rule Information:</div>
                            <p>${finding.ruleInfo}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filterFindings() {
            const severityFilter = document.getElementById('severity-filter').value;
            const ruleFilter = document.getElementById('rule-filter').value;
            
            let filteredFindings = scanResults.findings;
            
            if (severityFilter) {
                filteredFindings = filteredFindings.filter(f => f.severity === severityFilter);
            }
            
            if (ruleFilter) {
                filteredFindings = filteredFindings.filter(f => f.rule.includes(ruleFilter));
            }
            
            renderFindings(filteredFindings);
        }

        function exportResults(format) {
            let content = '';
            let filename = '';
            let mimeType = '';
            
            switch(format) {
                case 'json':
                    content = JSON.stringify(scanResults, null, 2);
                    filename = `pressguard-scan-results-${new Date().toISOString().split('T')[0]}.json`;
                    mimeType = 'application/json';
                    break;
                    
                case 'csv':
                    content = generateCSV();
                    filename = `pressguard-scan-results-${new Date().toISOString().split('T')[0]}.csv`;
                    mimeType = 'text/csv';
                    break;
                    
                case 'html':
                    content = generateHTMLReport();
                    filename = `pressguard-scan-results-${new Date().toISOString().split('T')[0]}.html`;
                    mimeType = 'text/html';
                    break;
            }
            
            // Create and download the file
            const blob = new Blob([content], { type: mimeType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
        
        function generateCSV() {
            let csv = 'Rule Name,Severity,File,Line,Column,Message\n';
            
            scanResults.findings.forEach(finding => {
                csv += `"${finding.ruleName}","${finding.severity}","${finding.file}","${finding.line}","${finding.column}","${finding.message}"\n`;
            });
            
            return csv;
        }
        
        function generateHTMLReport() {
            return `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PressGuard Scan Results - ${new Date().toLocaleDateString()}</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background: #667eea; color: white; padding: 20px; border-radius: 8px; }
        .finding { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 5px; }
        .severity-error { border-left: 5px solid #dc3545; }
        .severity-warning { border-left: 5px solid #ffc107; }
        .severity-info { border-left: 5px solid #17a2b8; }
        .code { background: #f8f9fa; padding: 10px; border-radius: 3px; font-family: monospace; }
        .fix { background: #d4edda; padding: 10px; border-radius: 3px; margin-top: 10px; }
        .summary { background: #e7f3ff; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div class="header">
        <h1>PressGuard Security Scan Results</h1>
        <p>Generated on: ${new Date().toLocaleString()}</p>
    </div>
    
    <div class="summary">
        <h2>Scan Summary</h2>
        <p><strong>Total Findings:</strong> ${scanResults.totalFindings}</p>
        <p><strong>Files Scanned:</strong> ${scanResults.filesScanned}</p>
        <p><strong>Critical Issues:</strong> ${scanResults.criticalIssues}</p>
        <p><strong>Scan Duration:</strong> ${scanResults.scanTime}s</p>
    </div>
    
    <h2>Security Findings</h2>
    ${scanResults.findings.map(finding => `
        <div class="finding severity-${finding.severity.toLowerCase()}">
            <h3>${finding.ruleName}</h3>
            <p><strong>Severity:</strong> ${finding.severity}</p>
            <p><strong>File:</strong> ${finding.file}:${finding.line}:${finding.column}</p>
            <p><strong>Message:</strong> ${finding.message}</p>
            <div class="code">${finding.code}</div>
            <div class="fix">
                <strong>How to Fix:</strong><br>
                ${finding.fix}<br>
                <div class="code">${finding.fixCode}</div>
            </div>
        </div>
    `).join('')}
</body>
</html>`;
        }

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateSummary();
            renderFindings();
            
            // Add event listeners for filters
            document.getElementById('severity-filter').addEventListener('change', filterFindings);
            document.getElementById('rule-filter').addEventListener('change', filterFindings);
        });
    </script>
</body>
</html>
